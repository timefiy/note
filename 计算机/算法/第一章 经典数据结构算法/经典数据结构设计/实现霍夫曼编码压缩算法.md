---
title: 实现霍夫曼编码压缩算法
source: https://labuladong.online/zh/algo/data-structure/huffman-tree-implementation/
author:
  - "[[../../../../author/labuladong]]"
published:
created: 2026-02-17
description: 滑动窗口是一种快慢指针技巧，一快一慢两个指针前后相随，中间的部分就是窗口。滑动窗口算法技巧主要用来解决子数组问题，比如让你寻找符合某个条件的最长/最短子数组。本文介绍滑动窗口算法核心框架，总结了力扣/LeetCode 上所有滑动窗口问题的通用解题思路和代码模板。
tags:
  - clippings
---
前置知识

阅读本文前，你需要先学习：

- [霍夫曼树基础](https://labuladong.online/zh/algo/data-structure-basic/huffman-tree/)
- [二叉堆原理及实现](https://labuladong.online/zh/algo/data-structure-basic/binary-heap-basic/)

[霍夫曼树基础](https://labuladong.online/zh/algo/data-structure-basic/huffman-tree/) 介绍了定长编码、变长编码、有损压缩、无损压缩的一些基本概念，并引出一个关键的发现：

**利用二叉树结构来构造编码，可以确保变长编码的解码过程不产生歧义** 。

现在的关键在于，怎么构造这棵二叉树，才能使得编码后的数据长度最短？

霍夫曼编码（Huffman Coding）就是一种最优编码算法，它通过巧妙的方式来构造二叉树，使得树的带权路径长度（Weighted Path Length）最小，即编码后的数据长度最短。

本文将介绍它的原理，并实现一个可运行的压缩程序来运用这个算法进行文本文件压缩。

不过在介绍霍夫曼编码之前，我们不妨尝试基于目前已知的知识来发明一个构造编码树的算法。

## 再谈定长编码

首先可以发现， **[定长编码](https://labuladong.online/zh/algo/data-structure-basic/huffman-tree/) 其实就是一棵高度为 `logN` 的 [完全二叉树](https://labuladong.online/zh/algo/data-structure-basic/binary-tree-basic/)** 。

比如这样一棵二叉树：

<svg xmlns="http://www.w3.org/2000/svg" width="387.4000000000001" height="273" class="block" style="max-width: 100%; height: auto;"><g><line x1="193.70000000000005" y1="66.5" x2="108.90000000000003" y2="136.5" stroke="#999" stroke-width="2" stroke-linecap="round"></line><line x1="108.90000000000003" y1="136.5" x2="66.5" y2="206.5" stroke="#999" stroke-width="2" stroke-linecap="round"></line><line x1="108.90000000000003" y1="136.5" x2="151.30000000000007" y2="206.5" stroke="#999" stroke-width="2" stroke-linecap="round"></line><line x1="193.70000000000005" y1="66.5" x2="278.50000000000006" y2="136.5" stroke="#999" stroke-width="2" stroke-linecap="round"></line><line x1="278.50000000000006" y1="136.5" x2="236.10000000000002" y2="206.5" stroke="#999" stroke-width="2" stroke-linecap="round"></line><line x1="278.50000000000006" y1="136.5" x2="320.9000000000001" y2="206.5" stroke="#999" stroke-width="2" stroke-linecap="round"></line></g><g><g><circle cx="193.70000000000005" cy="66.5" r="16.5" fill="#7dace3" stroke="#999" stroke-width="2"></circle><text x="193.70000000000005" y="71.5" font-size="15" fill="#000" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" style="pointer-events: none;">-</text></g> <g><circle cx="108.90000000000003" cy="136.5" r="16.5" fill="#7dace3" stroke="#999" stroke-width="2"></circle><text x="108.90000000000003" y="141.5" font-size="15" fill="#000" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" style="pointer-events: none;">-</text></g> <g><circle cx="66.5" cy="206.5" r="16.5" fill="#7dace3" stroke="#999" stroke-width="2"></circle><text x="66.5" y="211.5" font-size="15" fill="#000" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" style="pointer-events: none;">a</text></g> <g><circle cx="151.30000000000007" cy="206.5" r="16.5" fill="#7dace3" stroke="#999" stroke-width="2"></circle><text x="151.30000000000007" y="211.5" font-size="15" fill="#000" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" style="pointer-events: none;">b</text></g> <g><circle cx="278.50000000000006" cy="136.5" r="16.5" fill="#7dace3" stroke="#999" stroke-width="2"></circle><text x="278.50000000000006" y="141.5" font-size="15" fill="#000" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" style="pointer-events: none;">-</text></g> <g><circle cx="236.10000000000002" cy="206.5" r="16.5" fill="#7dace3" stroke="#999" stroke-width="2"></circle><text x="236.10000000000002" y="211.5" font-size="15" fill="#000" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" style="pointer-events: none;">c</text></g> <g><circle cx="320.9000000000001" cy="206.5" r="16.5" fill="#7dace3" stroke="#999" stroke-width="2"></circle><text x="320.9000000000001" y="211.5" font-size="15" fill="#000" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" style="pointer-events: none;">d</text></g></g> <g><g><rect x="145.30000000000004" y="94" width="12" height="15" fill="#f9f9f9" rx="1"></rect><text x="151.30000000000004" y="106.5" font-size="12" fill="#333" text-anchor="middle" font-family="Arial, sans-serif" font-weight="500" style="pointer-events: none;">0</text></g> <g><rect x="81.70000000000002" y="164" width="12" height="15" fill="#f9f9f9" rx="1"></rect><text x="87.70000000000002" y="176.5" font-size="12" fill="#333" text-anchor="middle" font-family="Arial, sans-serif" font-weight="500" style="pointer-events: none;">0</text></g> <g><rect x="124.10000000000005" y="164" width="12" height="15" fill="#f9f9f9" rx="1"></rect><text x="130.10000000000005" y="176.5" font-size="12" fill="#333" text-anchor="middle" font-family="Arial, sans-serif" font-weight="500" style="pointer-events: none;">1</text></g> <g><rect x="230.10000000000005" y="94" width="12" height="15" fill="#f9f9f9" rx="1"></rect><text x="236.10000000000005" y="106.5" font-size="12" fill="#333" text-anchor="middle" font-family="Arial, sans-serif" font-weight="500" style="pointer-events: none;">1</text></g> <g><rect x="251.30000000000007" y="164" width="12" height="15" fill="#f9f9f9" rx="1"></rect><text x="257.30000000000007" y="176.5" font-size="12" fill="#333" text-anchor="middle" font-family="Arial, sans-serif" font-weight="500" style="pointer-events: none;">0</text></g> <g><rect x="293.70000000000005" y="164" width="12" height="15" fill="#f9f9f9" rx="1"></rect><text x="299.70000000000005" y="176.5" font-size="12" fill="#333" text-anchor="middle" font-family="Arial, sans-serif" font-weight="500" style="pointer-events: none;">1</text></g></g></svg>

四个字符的编码如下：

```
a -> 00

b -> 01

c -> 10

d -> 11
```

假设共有 `N` 个字符，这棵二叉树的高度为 `logN` ，每个字符的编码长度等于树高，所以编码后的数据长度为 `N * logN` 。

定长编码的问题在于没有考虑字符出现的频率，我们可以对高频的字符使用更短的编码，对低频的字符使用更长的编码，这样可以使得编码后的数据总长度更短。

## 再谈变长编码

显然，频率高的字符应该尽可能靠近根节点，这样能确保高频出现的字符用用更短的编码长度。

所以我能想到的一个最简单的优化思路是对所有字符按照出现的频率进行排序，然后构建一棵向右延伸的二叉树。

比如 `a,b,c,d` 四个字符出现的频率分别是 `4,3,2,1` ，那么我就构建这样一棵二叉树：

<svg xmlns="http://www.w3.org/2000/svg" width="384.75000000000006" height="343" class="block" style="max-width: 100%; height: auto;"><g><line x1="151.3" y1="66.5" x2="66.5" y2="136.5" stroke="#999" stroke-width="2" stroke-linecap="round"></line><line x1="151.3" y1="66.5" x2="236.10000000000002" y2="136.5" stroke="#999" stroke-width="2" stroke-linecap="round"></line><line x1="236.10000000000002" y1="136.5" x2="193.7" y2="206.5" stroke="#999" stroke-width="2" stroke-linecap="round"></line><line x1="236.10000000000002" y1="136.5" x2="278.50000000000006" y2="206.5" stroke="#999" stroke-width="2" stroke-linecap="round"></line><line x1="278.50000000000006" y1="206.5" x2="238.75000000000006" y2="276.5" stroke="#999" stroke-width="2" stroke-linecap="round"></line><line x1="278.50000000000006" y1="206.5" x2="318.25000000000006" y2="276.5" stroke="#999" stroke-width="2" stroke-linecap="round"></line></g><g><g><circle cx="151.3" cy="66.5" r="16.5" fill="#7dace3" stroke="#999" stroke-width="2"></circle><text x="151.3" y="71.5" font-size="15" fill="#000" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" style="pointer-events: none;">-</text></g> <g><circle cx="66.5" cy="136.5" r="16.5" fill="#7dace3" stroke="#999" stroke-width="2"></circle><text x="66.5" y="141.5" font-size="15" fill="#000" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" style="pointer-events: none;">a</text></g> <g><circle cx="236.10000000000002" cy="136.5" r="16.5" fill="#7dace3" stroke="#999" stroke-width="2"></circle><text x="236.10000000000002" y="141.5" font-size="15" fill="#000" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" style="pointer-events: none;">-</text></g> <g><circle cx="193.7" cy="206.5" r="16.5" fill="#7dace3" stroke="#999" stroke-width="2"></circle><text x="193.7" y="211.5" font-size="15" fill="#000" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" style="pointer-events: none;">b</text></g> <g><circle cx="278.50000000000006" cy="206.5" r="16.5" fill="#7dace3" stroke="#999" stroke-width="2"></circle><text x="278.50000000000006" y="211.5" font-size="15" fill="#000" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" style="pointer-events: none;">-</text></g> <g><circle cx="238.75000000000006" cy="276.5" r="16.5" fill="#7dace3" stroke="#999" stroke-width="2"></circle><text x="238.75000000000006" y="281.5" font-size="15" fill="#000" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" style="pointer-events: none;">c</text></g> <g><circle cx="318.25000000000006" cy="276.5" r="16.5" fill="#7dace3" stroke="#999" stroke-width="2"></circle><text x="318.25000000000006" y="281.5" font-size="15" fill="#000" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" style="pointer-events: none;">d</text></g></g> <g><g><rect x="102.9" y="94" width="12" height="15" fill="#f9f9f9" rx="1"></rect><text x="108.9" y="106.5" font-size="12" fill="#333" text-anchor="middle" font-family="Arial, sans-serif" font-weight="500" style="pointer-events: none;">0</text></g> <g><rect x="187.70000000000002" y="94" width="12" height="15" fill="#f9f9f9" rx="1"></rect><text x="193.70000000000002" y="106.5" font-size="12" fill="#333" text-anchor="middle" font-family="Arial, sans-serif" font-weight="500" style="pointer-events: none;">1</text></g> <g><rect x="208.9" y="164" width="12" height="15" fill="#f9f9f9" rx="1"></rect><text x="214.9" y="176.5" font-size="12" fill="#333" text-anchor="middle" font-family="Arial, sans-serif" font-weight="500" style="pointer-events: none;">0</text></g> <g><rect x="251.30000000000007" y="164" width="12" height="15" fill="#f9f9f9" rx="1"></rect><text x="257.30000000000007" y="176.5" font-size="12" fill="#333" text-anchor="middle" font-family="Arial, sans-serif" font-weight="500" style="pointer-events: none;">1</text></g> <g><rect x="252.62500000000006" y="234" width="12" height="15" fill="#f9f9f9" rx="1"></rect><text x="258.62500000000006" y="246.5" font-size="12" fill="#333" text-anchor="middle" font-family="Arial, sans-serif" font-weight="500" style="pointer-events: none;">0</text></g> <g><rect x="292.37500000000006" y="234" width="12" height="15" fill="#f9f9f9" rx="1"></rect><text x="298.37500000000006" y="246.5" font-size="12" fill="#333" text-anchor="middle" font-family="Arial, sans-serif" font-weight="500" style="pointer-events: none;">1</text></g></g></svg>

在这个例子中，出现频率最高的字符 `a` 的编码长度为 1，频率第二高的字符 `b` 的编码长度为 2，频率最低的两个字符 `c,d` 的编码长度为 3。

这种构造方法考虑了字符出现的频率，频率越高的字符，编码越短，看起来应该会有更好的压缩效果。

那么请你仔细思考，这种编码方案是否能够保证获得最短编码方案？

实际上，这种依赖简单排序的编码方案在很多情况下都不是最优的。

举一个最简单的反例，比方说 `a,b,c,d` 四个字符出现的频率都是 1，按照这种构造方法，最后得到的编码长度为 `1 + 2 + 3 + 3 = 9` ，还不如定长编码方案 `4 * 2 = 8` 的压缩效果好。

## 霍夫曼树原理

接下来，我们看看霍夫曼树是如何构造的，为什么这种构造方法能够保证获得最短编码方案。

首先，我们重新描述一下问题和目标：

- 字符集合：假设有 $n$ 个字符 ${c_1,c_2,...,c_n}$ 。
- 权重（频率）：每个字符 $c_i$ 对应一个权重（频率） $w_i$ 。
- 路径长度：在构建出的二叉树中，从根节点到代表字符 $c_i$ 的叶子节点的路径上经过的边的数量，记为 $l_i$ 。这也就是该字符最终编码的长度。
- **带权路径长度 (WPL)：我们的优化目标** 。它的计算公式是树中所有叶子节点的带权路径长度之和：
$$
WPL = \sum_{i=1}^{n} (w_i 	\times l_i)
$$

同时，我们优化一下二叉树， **让叶子节点显示字符和频率，让非叶子节点显示其子节点的总频率** 。

比如这棵二叉树：

<svg xmlns="http://www.w3.org/2000/svg" width="384.75000000000006" height="343" class="block" style="max-width: 100%; height: auto;"><g><line x1="151.3" y1="66.5" x2="66.5" y2="136.5" stroke="#999" stroke-width="2" stroke-linecap="round"></line><line x1="151.3" y1="66.5" x2="236.10000000000002" y2="136.5" stroke="#999" stroke-width="2" stroke-linecap="round"></line><line x1="236.10000000000002" y1="136.5" x2="193.7" y2="206.5" stroke="#999" stroke-width="2" stroke-linecap="round"></line><line x1="236.10000000000002" y1="136.5" x2="278.50000000000006" y2="206.5" stroke="#999" stroke-width="2" stroke-linecap="round"></line><line x1="278.50000000000006" y1="206.5" x2="238.75000000000006" y2="276.5" stroke="#999" stroke-width="2" stroke-linecap="round"></line><line x1="278.50000000000006" y1="206.5" x2="318.25000000000006" y2="276.5" stroke="#999" stroke-width="2" stroke-linecap="round"></line></g><g><g><circle cx="151.3" cy="66.5" r="16.5" fill="#7dace3" stroke="#999" stroke-width="2"></circle><text x="151.3" y="71.5" font-size="15" fill="#000" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" style="pointer-events: none;">12</text></g> <g><circle cx="66.5" cy="136.5" r="16.5" fill="#7dace3" stroke="#999" stroke-width="2"></circle><text x="66.5" y="141.5" font-size="15" fill="#000" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" style="pointer-events: none;">a:4</text></g> <g><circle cx="236.10000000000002" cy="136.5" r="16.5" fill="#7dace3" stroke="#999" stroke-width="2"></circle><text x="236.10000000000002" y="141.5" font-size="15" fill="#000" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" style="pointer-events: none;">8</text></g> <g><circle cx="193.7" cy="206.5" r="16.5" fill="#7dace3" stroke="#999" stroke-width="2"></circle><text x="193.7" y="211.5" font-size="15" fill="#000" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" style="pointer-events: none;">b:3</text></g> <g><circle cx="278.50000000000006" cy="206.5" r="16.5" fill="#7dace3" stroke="#999" stroke-width="2"></circle><text x="278.50000000000006" y="211.5" font-size="15" fill="#000" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" style="pointer-events: none;">5</text></g> <g><circle cx="238.75000000000006" cy="276.5" r="16.5" fill="#7dace3" stroke="#999" stroke-width="2"></circle><text x="238.75000000000006" y="281.5" font-size="15" fill="#000" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" style="pointer-events: none;">c:3</text></g> <g><circle cx="318.25000000000006" cy="276.5" r="16.5" fill="#7dace3" stroke="#999" stroke-width="2"></circle><text x="318.25000000000006" y="281.5" font-size="15" fill="#000" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" style="pointer-events: none;">d:2</text></g></g> <g><g><rect x="102.9" y="94" width="12" height="15" fill="#f9f9f9" rx="1"></rect><text x="108.9" y="106.5" font-size="12" fill="#333" text-anchor="middle" font-family="Arial, sans-serif" font-weight="500" style="pointer-events: none;">0</text></g> <g><rect x="187.70000000000002" y="94" width="12" height="15" fill="#f9f9f9" rx="1"></rect><text x="193.70000000000002" y="106.5" font-size="12" fill="#333" text-anchor="middle" font-family="Arial, sans-serif" font-weight="500" style="pointer-events: none;">1</text></g> <g><rect x="208.9" y="164" width="12" height="15" fill="#f9f9f9" rx="1"></rect><text x="214.9" y="176.5" font-size="12" fill="#333" text-anchor="middle" font-family="Arial, sans-serif" font-weight="500" style="pointer-events: none;">0</text></g> <g><rect x="251.30000000000007" y="164" width="12" height="15" fill="#f9f9f9" rx="1"></rect><text x="257.30000000000007" y="176.5" font-size="12" fill="#333" text-anchor="middle" font-family="Arial, sans-serif" font-weight="500" style="pointer-events: none;">1</text></g> <g><rect x="252.62500000000006" y="234" width="12" height="15" fill="#f9f9f9" rx="1"></rect><text x="258.62500000000006" y="246.5" font-size="12" fill="#333" text-anchor="middle" font-family="Arial, sans-serif" font-weight="500" style="pointer-events: none;">0</text></g> <g><rect x="292.37500000000006" y="234" width="12" height="15" fill="#f9f9f9" rx="1"></rect><text x="298.37500000000006" y="246.5" font-size="12" fill="#333" text-anchor="middle" font-family="Arial, sans-serif" font-weight="500" style="pointer-events: none;">1</text></g></g></svg>

接下来，有一个重要的结论： **所有非叶子节点的频率之和等于 $WPL$** ，这个规律对任意二叉编码树都是成立的。

比如上面的例子，各个字符的编码方案是：

编码长度每个字符的编码长度乘以频率，最后求和：

$$
WPL = 4 \times 1 + 3 \times 2 + 3 \times 3 + 3 \times 2 = 25
$$

你再看所有非叶子节点，它们的频率之和为 $5+8+12=25$ ，和 $WPL$ 相等。

基于这个规律，我们的问题转化为：

**如何构造一棵二叉编码树，使得所有非叶子节点的频率之和最小** ？

霍夫曼树的构造流程是这样的：

1. 计算每个字符出现的频率，每个字符构成一个叶子节点。将所有叶子节点插入 [优先级队列](https://labuladong.online/zh/algo/data-structure-basic/binary-heap-basic/) 中，频率最小的叶子节点优先出队。
2. 取出频率最小的两个叶子节点，合并成一个非叶子节点，该节点的频率为两个子节点频率之和。
3. 将新节点重新插入到优先级队列中，继续按照频率从小到大排序。
4. 重复步骤 2 和 3，直到优先级队列中只剩下一个节点，即霍夫曼树的根节点。

**这是典型的贪心思想，每次都选择频率最小的两个节点进行合并，最后得到的二叉编码树中，所有非叶子节点的频率之和最小** 。

比如字符频率为：

首先把这些字符作为叶子节点插入优先级队列中，从小到大排列：

去除最小的两个节点，合并成一个新节点，频率为两个子节点频率之和：

<svg xmlns="http://www.w3.org/2000/svg" width="217.79999999999995" height="203" class="block" style="max-width: 100%; height: auto;"><g><line x1="108.89999999999998" y1="66.5" x2="66.5" y2="136.5" stroke="#999" stroke-width="2" stroke-linecap="round"></line><line x1="108.89999999999998" y1="66.5" x2="151.29999999999995" y2="136.5" stroke="#999" stroke-width="2" stroke-linecap="round"></line></g><g><g><circle cx="108.89999999999998" cy="66.5" r="16.5" fill="#7dace3" stroke="#999" stroke-width="2"></circle><text x="108.89999999999998" y="71.5" font-size="15" fill="#000" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" style="pointer-events: none;">5</text></g> <g><circle cx="66.5" cy="136.5" r="16.5" fill="#7dace3" stroke="#999" stroke-width="2"></circle><text x="66.5" y="141.5" font-size="15" fill="#000" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" style="pointer-events: none;">d:2</text></g> <g><circle cx="151.29999999999995" cy="136.5" r="16.5" fill="#7dace3" stroke="#999" stroke-width="2"></circle><text x="151.29999999999995" y="141.5" font-size="15" fill="#000" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" style="pointer-events: none;">c:3</text></g></g> <g><g><rect x="81.69999999999999" y="94" width="12" height="15" fill="#f9f9f9" rx="1"></rect><text x="87.69999999999999" y="106.5" font-size="12" fill="#333" text-anchor="middle" font-family="Arial, sans-serif" font-weight="500" style="pointer-events: none;">0</text></g> <g><rect x="124.09999999999997" y="94" width="12" height="15" fill="#f9f9f9" rx="1"></rect><text x="130.09999999999997" y="106.5" font-size="12" fill="#333" text-anchor="middle" font-family="Arial, sans-serif" font-weight="500" style="pointer-events: none;">1</text></g></g></svg>

将新节点重新插入优先级队列中，从小到大排列：

重复上述步骤，继续取出两个最小的节点，合并成一个新节点：

<svg xmlns="http://www.w3.org/2000/svg" width="217.79999999999995" height="203" class="block" style="max-width: 100%; height: auto;"><g><line x1="108.89999999999998" y1="66.5" x2="66.5" y2="136.5" stroke="#999" stroke-width="2" stroke-linecap="round"></line><line x1="108.89999999999998" y1="66.5" x2="151.29999999999995" y2="136.5" stroke="#999" stroke-width="2" stroke-linecap="round"></line></g><g><g><circle cx="108.89999999999998" cy="66.5" r="16.5" fill="#7dace3" stroke="#999" stroke-width="2"></circle><text x="108.89999999999998" y="71.5" font-size="15" fill="#000" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" style="pointer-events: none;">7</text></g> <g><circle cx="66.5" cy="136.5" r="16.5" fill="#7dace3" stroke="#999" stroke-width="2"></circle><text x="66.5" y="141.5" font-size="15" fill="#000" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" style="pointer-events: none;">b:3</text></g> <g><circle cx="151.29999999999995" cy="136.5" r="16.5" fill="#7dace3" stroke="#999" stroke-width="2"></circle><text x="151.29999999999995" y="141.5" font-size="15" fill="#000" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" style="pointer-events: none;">a:4</text></g></g> <g><g><rect x="81.69999999999999" y="94" width="12" height="15" fill="#f9f9f9" rx="1"></rect><text x="87.69999999999999" y="106.5" font-size="12" fill="#333" text-anchor="middle" font-family="Arial, sans-serif" font-weight="500" style="pointer-events: none;">0</text></g> <g><rect x="124.09999999999997" y="94" width="12" height="15" fill="#f9f9f9" rx="1"></rect><text x="130.09999999999997" y="106.5" font-size="12" fill="#333" text-anchor="middle" font-family="Arial, sans-serif" font-weight="500" style="pointer-events: none;">1</text></g></g></svg>

将新节点重新插入优先级队列中，从小到大排列：

重复上述步骤，继续取出两个最小的节点，合并成一个新节点：

<svg xmlns="http://www.w3.org/2000/svg" width="387.4000000000001" height="273" class="block" style="max-width: 100%; height: auto;"><g><line x1="193.70000000000005" y1="66.5" x2="108.90000000000003" y2="136.5" stroke="#999" stroke-width="2" stroke-linecap="round"></line><line x1="108.90000000000003" y1="136.5" x2="66.5" y2="206.5" stroke="#999" stroke-width="2" stroke-linecap="round"></line><line x1="108.90000000000003" y1="136.5" x2="151.30000000000007" y2="206.5" stroke="#999" stroke-width="2" stroke-linecap="round"></line><line x1="193.70000000000005" y1="66.5" x2="278.50000000000006" y2="136.5" stroke="#999" stroke-width="2" stroke-linecap="round"></line><line x1="278.50000000000006" y1="136.5" x2="236.10000000000002" y2="206.5" stroke="#999" stroke-width="2" stroke-linecap="round"></line><line x1="278.50000000000006" y1="136.5" x2="320.9000000000001" y2="206.5" stroke="#999" stroke-width="2" stroke-linecap="round"></line></g><g><g><circle cx="193.70000000000005" cy="66.5" r="16.5" fill="#7dace3" stroke="#999" stroke-width="2"></circle><text x="193.70000000000005" y="71.5" font-size="15" fill="#000" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" style="pointer-events: none;">12</text></g> <g><circle cx="108.90000000000003" cy="136.5" r="16.5" fill="#7dace3" stroke="#999" stroke-width="2"></circle><text x="108.90000000000003" y="141.5" font-size="15" fill="#000" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" style="pointer-events: none;">5</text></g> <g><circle cx="66.5" cy="206.5" r="16.5" fill="#7dace3" stroke="#999" stroke-width="2"></circle><text x="66.5" y="211.5" font-size="15" fill="#000" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" style="pointer-events: none;">d:2</text></g> <g><circle cx="151.30000000000007" cy="206.5" r="16.5" fill="#7dace3" stroke="#999" stroke-width="2"></circle><text x="151.30000000000007" y="211.5" font-size="15" fill="#000" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" style="pointer-events: none;">c:3</text></g> <g><circle cx="278.50000000000006" cy="136.5" r="16.5" fill="#7dace3" stroke="#999" stroke-width="2"></circle><text x="278.50000000000006" y="141.5" font-size="15" fill="#000" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" style="pointer-events: none;">7</text></g> <g><circle cx="236.10000000000002" cy="206.5" r="16.5" fill="#7dace3" stroke="#999" stroke-width="2"></circle><text x="236.10000000000002" y="211.5" font-size="15" fill="#000" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" style="pointer-events: none;">b:3</text></g> <g><circle cx="320.9000000000001" cy="206.5" r="16.5" fill="#7dace3" stroke="#999" stroke-width="2"></circle><text x="320.9000000000001" y="211.5" font-size="15" fill="#000" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" style="pointer-events: none;">a:4</text></g></g> <g><g><rect x="145.30000000000004" y="94" width="12" height="15" fill="#f9f9f9" rx="1"></rect><text x="151.30000000000004" y="106.5" font-size="12" fill="#333" text-anchor="middle" font-family="Arial, sans-serif" font-weight="500" style="pointer-events: none;">0</text></g> <g><rect x="81.70000000000002" y="164" width="12" height="15" fill="#f9f9f9" rx="1"></rect><text x="87.70000000000002" y="176.5" font-size="12" fill="#333" text-anchor="middle" font-family="Arial, sans-serif" font-weight="500" style="pointer-events: none;">0</text></g> <g><rect x="124.10000000000005" y="164" width="12" height="15" fill="#f9f9f9" rx="1"></rect><text x="130.10000000000005" y="176.5" font-size="12" fill="#333" text-anchor="middle" font-family="Arial, sans-serif" font-weight="500" style="pointer-events: none;">1</text></g> <g><rect x="230.10000000000005" y="94" width="12" height="15" fill="#f9f9f9" rx="1"></rect><text x="236.10000000000005" y="106.5" font-size="12" fill="#333" text-anchor="middle" font-family="Arial, sans-serif" font-weight="500" style="pointer-events: none;">1</text></g> <g><rect x="251.30000000000007" y="164" width="12" height="15" fill="#f9f9f9" rx="1"></rect><text x="257.30000000000007" y="176.5" font-size="12" fill="#333" text-anchor="middle" font-family="Arial, sans-serif" font-weight="500" style="pointer-events: none;">0</text></g> <g><rect x="293.70000000000005" y="164" width="12" height="15" fill="#f9f9f9" rx="1"></rect><text x="299.70000000000005" y="176.5" font-size="12" fill="#333" text-anchor="middle" font-family="Arial, sans-serif" font-weight="500" style="pointer-events: none;">1</text></g></g></svg>

此时优先级队列中只剩下这一个节点，即霍夫曼树的根节点。

对于这棵霍夫曼树，每个字符的编码如下：

总的编码长度为 $WPL = 5 + 7 + 12 = 24$ ，就是最优编码方式。

下面，我们来编写霍夫曼编码算法，实现一个简单的压缩和解压缩工具。

## 代码实现

首先我们实现一套读写 bit 流的工具类，方便逐个 bit 读写文件。

下面给出霍夫曼压缩的示例代码，输入文件为 `input.txt` ，压缩后会生成 `compressed.htable` 和 `compressed.bin` 两个文件，分别是码表文件和压缩后的数据文件，解压缩时会读取这两个文件，生成 `decompressed.txt` 文件。

有几个点需要提前说一下：

1、示例为了方便展示，把码表和压缩后的数据分为两个文件存储， **实际中一般会把码表和压缩后的数据合并成一个文件存储** 。

2、码表中记录的字符编码是 `97:01` 这种格式，代表着字符 `a` （UTF-8 码为 97）的霍夫曼编码为 `01` 。

**为什么不直接用 `a:01` 这种格式呢？主要是为了方便处理特殊字符** 。

比方说换行符 `\n` ，我们的码表本来就依赖换行来分割每个映射，如果直接在码表中输入 `\n` ，就会破坏码表结构。而把所有字符转化为一个唯一 ID 进行存储，就很容易处理特殊字符。

3、码表文件 `compressed.htable` 中的第一行是 `total_chars` 字段，记录了原始数据中共有多少个字符。

你是否有疑惑，为什么需要这个字段？理论上讲，码表包含每个字符的编码，而且已经在算法层面保证了解码的唯一性，也就是说给我压缩后的数据和码表，必然可以无歧义地还原出原始数据，那么是不是可以删掉这个字段呢？

答案是不可以省略。原因和算法无关，而和计算机读写文件的原理有关： **计算机的最小读写单位是 1 字节（byte），也就是 8 比特（bit）。换句话说，文件的大小必须是 8 比特的整数倍** 。

那么假设待压缩文件内容为 `aaa` 三个字符，我们将字符 `a` 编码为 1 bit 的二进制 `0` ，那么压缩后的数据为二进制的 `000` ，长度为 3 bit，不是 8 比特的整数倍。

计算机为了存储这个文件，会自动在末尾补上 5 个比特的 `0` ，使得文件大小变为 8 比特的整数倍，最终存储的内容为二进制的 `00000000` 。

如果我们不记录 `total_chars` 字段，那么解压缩时会把末尾的 5 个填充 `0` 也认为是有效编码，导致解压缩的数据和原始数据不一致。这就是需要记录 `total_chars` 字段的原因。

我在 `input.txt` 中输入了如下字符串：

执行程序，输出如下：

更新时间：2026/02/17 14:24

## 评论

Markdown

Ctrl+Enter 发表