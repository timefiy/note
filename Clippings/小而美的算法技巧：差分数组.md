---
title: "å°è€Œç¾çš„ç®—æ³•æŠ€å·§ï¼šå·®åˆ†æ•°ç»„"
source: "https://labuladong.online/zh/algo/data-structure/diff-array/"
author:
  - "[[labuladong]]"
published:
created: 2026-02-17
description: "æœ¬æ–‡è®²è§£å·®åˆ†æ•°ç»„æŠ€å·§ï¼Œå¿«é€Ÿè§£å†³åŒºé—´å¢å‡é—®é¢˜ï¼Œè§£å†³åŠ›æ‰£/LeetCode çš„ç›¸å…³ä¾‹é¢˜ï¼ŒåŒæ—¶ç»™å‡º Java/Python/Go/JavaScript/C++ ä»£ç å®ç°ã€‚"
tags:
  - "clippings"
---
è¯»å®Œæœ¬æ–‡ï¼Œä½ ä¸ä»…å­¦ä¼šäº†ç®—æ³•å¥—è·¯ï¼Œè¿˜å¯ä»¥é¡ºä¾¿è§£å†³å¦‚ä¸‹é¢˜ç›®ï¼š

| LeetCode | åŠ›æ‰£ | éš¾åº¦ |
| --- | --- | --- |
| [370\. Range Addition](https://leetcode.com/problems/range-addition/) ğŸ”’ | [370\. åŒºé—´åŠ æ³•](https://leetcode.cn/problems/range-addition/) ğŸ”’ |  |
| [1109\. Corporate Flight Bookings](https://leetcode.com/problems/corporate-flight-bookings/) | [1109\. èˆªç­é¢„è®¢ç»Ÿè®¡](https://leetcode.cn/problems/corporate-flight-bookings/) |  |
| [1094\. Car Pooling](https://leetcode.com/problems/car-pooling/) | [1094\. æ‹¼è½¦](https://leetcode.cn/problems/car-pooling/) |  |

å‰ç½®çŸ¥è¯†

é˜…è¯»æœ¬æ–‡å‰ï¼Œä½ éœ€è¦å…ˆå­¦ä¹ ï¼š

- [æ•°ç»„åŸºç¡€](https://labuladong.online/zh/algo/data-structure-basic/array-basic/)
- [å‰ç¼€å’ŒæŠ€å·§](https://labuladong.online/zh/algo/data-structure/prefix-sum/)

[å‰ç¼€å’ŒæŠ€å·§](https://labuladong.online/zh/algo/data-structure/prefix-sum/) ä¸»è¦é€‚ç”¨çš„åœºæ™¯æ˜¯åŸå§‹æ•°ç»„ä¸ä¼šè¢«ä¿®æ”¹çš„æƒ…å†µä¸‹ï¼Œé¢‘ç¹æŸ¥è¯¢æŸä¸ªåŒºé—´çš„ç´¯åŠ å’Œï¼Œæ ¸å¿ƒä»£ç å°±æ˜¯ä¸‹é¢è¿™æ®µï¼š

```
class PrefixSum {

private:

    vector<int> prefix;

public:

    // å‰ç¼€å’Œæ•°ç»„

    PrefixSum(vector<int>& nums) {

        prefix = vector<int>(nums.size() + 1);

        // è®¡ç®— nums çš„ç´¯åŠ å’Œ

        for (int i = 1; i < nums.size() + 1; i++) {

            prefix[i] = prefix[i - 1] + nums[i - 1];

        }

    }

    // æŸ¥è¯¢é—­åŒºé—´ [i, j] çš„ç´¯åŠ å’Œ

    int query(int i, int j) {

        return prefix[j + 1] - prefix[i];

    }

};
```

![](https://labuladong.online/images/algo/difference/1.jpeg)

`preSum[i]` å°±ä»£è¡¨ç€ `nums[0..i-1]` æ‰€æœ‰å…ƒç´ çš„ç´¯åŠ å’Œï¼Œå¦‚æœæˆ‘ä»¬æƒ³æ±‚åŒºé—´ `nums[i..j]` çš„ç´¯åŠ å’Œï¼Œåªè¦è®¡ç®— `preSum[j+1] - preSum[i]` å³å¯ï¼Œè€Œä¸éœ€è¦éå†æ•´ä¸ªåŒºé—´æ±‚å’Œã€‚

æœ¬æ–‡è®²ä¸€ä¸ªå’Œå‰ç¼€å’Œæ€æƒ³éå¸¸ç±»ä¼¼çš„ç®—æ³•æŠ€å·§ã€Œå·®åˆ†æ•°ç»„ã€ï¼Œ **å·®åˆ†æ•°ç»„çš„ä¸»è¦é€‚ç”¨åœºæ™¯æ˜¯é¢‘ç¹å¯¹åŸå§‹æ•°ç»„çš„æŸä¸ªåŒºé—´çš„å…ƒç´ è¿›è¡Œå¢å‡** ã€‚

æ¯”å¦‚è¯´ï¼Œæˆ‘ç»™ä½ è¾“å…¥ä¸€ä¸ªæ•°ç»„ `nums` ï¼Œç„¶ååˆè¦æ±‚ç»™åŒºé—´ `nums[2..6]` å…¨éƒ¨åŠ  1ï¼Œå†ç»™ `nums[3..9]` å…¨éƒ¨å‡ 3ï¼Œå†ç»™ `nums[0..4]` å…¨éƒ¨åŠ  2ï¼Œå†ç»™...

ä¸€é€šæ“ä½œçŒ›å¦‚è™ï¼Œç„¶åé—®ä½ ï¼Œæœ€å `nums` æ•°ç»„çš„å€¼æ˜¯ä»€ä¹ˆï¼Ÿ

å¸¸è§„çš„æ€è·¯å¾ˆå®¹æ˜“ï¼Œä½ è®©æˆ‘ç»™åŒºé—´ `nums[i..j]` åŠ ä¸Š `val` ï¼Œé‚£æˆ‘å°±ä¸€ä¸ª for å¾ªç¯ç»™å®ƒä»¬éƒ½åŠ ä¸Šå‘—ï¼Œè¿˜èƒ½å’‹æ ·ï¼Ÿè¿™ç§æ€è·¯çš„æ—¶é—´å¤æ‚åº¦æ˜¯ $O(N)$ ï¼Œç”±äºè¿™ä¸ªåœºæ™¯ä¸‹å¯¹ `nums` çš„ä¿®æ”¹éå¸¸é¢‘ç¹ï¼Œæ‰€ä»¥æ•ˆç‡ä¼šå¾ˆä½ä¸‹ã€‚

è¿™é‡Œå°±éœ€è¦å·®åˆ†æ•°ç»„çš„æŠ€å·§ï¼Œç±»ä¼¼å‰ç¼€å’ŒæŠ€å·§æ„é€ çš„ `preSum` æ•°ç»„ï¼Œæˆ‘ä»¬å…ˆå¯¹ `nums` æ•°ç»„æ„é€ ä¸€ä¸ª `diff` å·®åˆ†æ•°ç»„ï¼Œ **`diff[i]` å°±æ˜¯ `nums[i]` å’Œ `nums[i-1]` ä¹‹å·®** ï¼š

```
int diff[nums.size()];

// æ„é€ å·®åˆ†æ•°ç»„

diff[0] = nums[0];

for (int i = 1; i < nums.size(); i++) {

    diff[i] = nums[i] - nums[i - 1];

}
```

![](https://labuladong.online/images/algo/difference/2.jpeg)

é€šè¿‡è¿™ä¸ª `diff` å·®åˆ†æ•°ç»„æ˜¯å¯ä»¥åæ¨å‡ºåŸå§‹æ•°ç»„ `nums` çš„ï¼Œä»£ç é€»è¾‘å¦‚ä¸‹ï¼š

```
int res[diff.size()];

// æ ¹æ®å·®åˆ†æ•°ç»„æ„é€ ç»“æœæ•°ç»„

res[0] = diff[0];

for (int i = 1; i < diff.size(); i++) {

    res[i] = res[i - 1] + diff[i];

}
```

**è¿™æ ·æ„é€ å·®åˆ†æ•°ç»„ `diff` ï¼Œå°±å¯ä»¥å¿«é€Ÿè¿›è¡ŒåŒºé—´å¢å‡çš„æ“ä½œ** ï¼Œå¦‚æœä½ æƒ³å¯¹åŒºé—´ `nums[i..j]` çš„å…ƒç´ å…¨éƒ¨åŠ  3ï¼Œé‚£ä¹ˆåªéœ€è¦è®© `diff[i] += 3` ï¼Œç„¶åå†è®© `diff[j+1] -= 3` å³å¯ï¼š

![](https://labuladong.online/images/algo/difference/3.jpeg)

**åŸç†å¾ˆç®€å•ï¼Œå›æƒ³ `diff` æ•°ç»„åæ¨ `nums` æ•°ç»„çš„è¿‡ç¨‹ï¼Œ `diff[i] += 3` æ„å‘³ç€ç»™ `nums[i..]` æ‰€æœ‰çš„å…ƒç´ éƒ½åŠ äº† 3ï¼Œç„¶å `diff[j+1] -= 3` åˆæ„å‘³ç€å¯¹äº `nums[j+1..]` æ‰€æœ‰å…ƒç´ å†å‡ 3ï¼Œé‚£ç»¼åˆèµ·æ¥ï¼Œæ˜¯ä¸æ˜¯å°±æ˜¯å¯¹ `nums[i..j]` ä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½åŠ  3 äº†** ï¼Ÿ

åªè¦èŠ±è´¹ O(1) çš„æ—¶é—´ä¿®æ”¹ `diff` æ•°ç»„ï¼Œå°±ç›¸å½“äºç»™ `nums` çš„æ•´ä¸ªåŒºé—´åšäº†ä¿®æ”¹ã€‚å¤šæ¬¡ä¿®æ”¹ `diff` ï¼Œç„¶åé€šè¿‡ `diff` æ•°ç»„åæ¨ï¼Œå³å¯å¾—åˆ° `nums` ä¿®æ”¹åçš„ç»“æœã€‚

ç°åœ¨æˆ‘ä»¬æŠŠå·®åˆ†æ•°ç»„æŠ½è±¡æˆä¸€ä¸ªç±»ï¼ŒåŒ…å« `increment` æ–¹æ³•å’Œ `result` æ–¹æ³•ï¼š

```
// å·®åˆ†æ•°ç»„å·¥å…·ç±»

class Difference {

    // å·®åˆ†æ•°ç»„

    private:

        vector<int> diff;

    

    // è¾“å…¥ä¸€ä¸ªåˆå§‹æ•°ç»„ï¼ŒåŒºé—´æ“ä½œå°†åœ¨è¿™ä¸ªæ•°ç»„ä¸Šè¿›è¡Œ

    public:

        Difference(vector<int>& nums) {

            diff = vector<int>(nums.size());

            // æ ¹æ®åˆå§‹æ•°ç»„æ„é€ å·®åˆ†æ•°ç»„

            diff[0] = nums[0];

            for (int i = 1; i < nums.size(); i++) {

                diff[i] = nums[i] - nums[i - 1];

            }

        }

        // ç»™é—­åŒºé—´ [i, j] å¢åŠ  valï¼ˆå¯ä»¥æ˜¯è´Ÿæ•°ï¼‰

        void increment(int i, int j, int val) {

            diff[i] += val;

            if (j + 1 < diff.size()) {

                diff[j + 1] -= val;

            }

        }

        // è¿”å›ç»“æœæ•°ç»„

        vector<int> result() {

            vector<int> res(diff.size());

            // æ ¹æ®å·®åˆ†æ•°ç»„æ„é€ ç»“æœæ•°ç»„

            res[0] = diff[0];

            for (int i = 1; i < diff.size(); i++) {

                res[i] = res[i - 1] + diff[i];

            }

            return res;

        }

};
```

è¿™é‡Œæ³¨æ„ä¸€ä¸‹ `increment` æ–¹æ³•ä¸­çš„ if è¯­å¥ï¼š

```
void increment(int i, int j, int val) {

    diff[i] += val;

    if (j + 1 < sizeof(diff)/sizeof(int)) {

        diff[j + 1] -= val;

    }

}
```

å½“ `j+1 >= diff.length` æ—¶ï¼Œè¯´æ˜æ˜¯å¯¹ `nums[i]` åŠä»¥åçš„æ•´ä¸ªæ•°ç»„éƒ½è¿›è¡Œä¿®æ”¹ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦å†ç»™ `diff` æ•°ç»„å‡ `val` äº†ã€‚

ä½ å¯ä»¥ç‚¹å¼€ä¸‹é¢çš„å¯è§†åŒ–é¢æ¿ï¼Œå¤šæ¬¡ç‚¹å‡» `diff[i] = nums[i] - nums[i - 1]` è¿™è¡Œä»£ç å°±å¯ä»¥çœ‹åˆ° `diff` æ•°ç»„çš„æ„å»ºè¿‡ç¨‹ï¼Œå†å¤šæ¬¡ç‚¹å‡» `df.increment` è¿™è¡Œä»£ç å¯ä»¥çœ‹åˆ° `diff` æ•°ç»„çš„æ“ä½œï¼š

ç®—æ³•å¯è§†åŒ–

## ç®—æ³•å®è·µ

åŠ›æ‰£ç¬¬ 370 é¢˜ã€Œ [åŒºé—´åŠ æ³•](https://leetcode.cn/problems/range-addition/) ã€ç›´æ¥è€ƒå¯Ÿäº†å·®åˆ†æ•°ç»„æŠ€å·§ï¼Œç›¸å½“äºç»™ä½ è¾“å…¥ä¸€ä¸ªé•¿åº¦ä¸º `n` çš„ `nums` æ•°ç»„ï¼Œå…¶ä¸­çš„å…ƒç´ åˆå§‹å€¼éƒ½ä¸º 0ï¼Œè®©ä½ å¯¹å…¶ä¸­çš„åŒºé—´å…ƒç´ è¿›è¡Œå¢å‡æ“ä½œï¼Œæœ€åè¿”å›æœ€ç»ˆçš„ `nums` æ•°ç»„ã€‚

æŠŠæˆ‘ä»¬å®ç°çš„ `Difference` ç±»å¤åˆ¶è¿‡å»å°±èƒ½è§£å†³ï¼š

```
class Solution {

public:

    vector<int> getModifiedArray(int length, vector<vector<int>>& updates) {

        // nums åˆå§‹åŒ–ä¸ºå…¨ 0

        vector<int> nums(length, 0);

        // æ„é€ å·®åˆ†è§£æ³•

        Difference df(nums);

        for (const auto& update : updates) {

            int i = update[0];

            int j = update[1];

            int val = update[2];

            df.increment(i, j, val);

        }

        return df.result();

    }

    class Difference {

        // å·®åˆ†æ•°ç»„

        vector<int> diff;

    public:

        Difference(const vector<int>& nums) {

            assert(!nums.empty());

            diff.resize(nums.size());

            // æ„é€ å·®åˆ†æ•°ç»„

            diff[0] = nums[0];

            for (size_t i = 1; i < nums.size(); ++i) {

                diff[i] = nums[i] - nums[i - 1];

            }

        }

        // ç»™é—­åŒºé—´ [i, j] å¢åŠ  valï¼ˆå¯ä»¥æ˜¯è´Ÿæ•°ï¼‰

        void increment(int i, int j, int val) {

            diff[i] += val;

            if (j + 1 < diff.size()) {

                diff[j + 1] -= val;

            }

        }

        vector<int> result() {

            vector<int> res(diff.size());

            // æ ¹æ®å·®åˆ†æ•°ç»„æ„é€ ç»“æœæ•°ç»„

            res[0] = diff[0];

            for (size_t i = 1; i < diff.size(); ++i) {

                res[i] = res[i - 1] + diff[i];

            }

            return res;

        }

    };

};
```

å½“ç„¶ï¼Œå®é™…çš„ç®—æ³•é¢˜å¯èƒ½éœ€è¦æˆ‘ä»¬å¯¹é¢˜ç›®è¿›è¡Œè”æƒ³å’ŒæŠ½è±¡ï¼Œä¸ä¼šè¿™ä¹ˆç›´æ¥åœ°è®©ä½ çœ‹å‡ºæ¥è¦ç”¨å·®åˆ†æ•°ç»„æŠ€å·§ï¼Œè¿™é‡Œçœ‹ä¸€ä¸‹åŠ›æ‰£ç¬¬ 1109 é¢˜ã€Œ [èˆªç­é¢„è®¢ç»Ÿè®¡](https://leetcode.cn/problems/corporate-flight-bookings/) ã€ï¼š

**1109\. èˆªç­é¢„è®¢ç»Ÿè®¡** | [åŠ›æ‰£](https://leetcode.cn/problems/corporate-flight-bookings/) | [LeetCode](https://leetcode.com/problems/corporate-flight-bookings/)

è¿™é‡Œæœ‰ `n` Â ä¸ªèˆªç­ï¼Œå®ƒä»¬åˆ†åˆ«ä» `1` åˆ° `n` è¿›è¡Œç¼–å·ã€‚

æœ‰ä¸€ä»½èˆªç­é¢„è®¢è¡¨ `bookings` ï¼Œè¡¨ä¸­ç¬¬Â  `i` Â æ¡é¢„è®¢è®°å½•Â  `bookings[i] = [first<sub>i</sub>, last<sub>i</sub>, seats<sub>i</sub>]` æ„å‘³ç€åœ¨ä» `first<sub>i</sub>` Â åˆ° `last<sub>i</sub>` ï¼ˆ **åŒ…å«** `first<sub>i</sub>` å’Œ `last<sub>i</sub>` ï¼‰çš„ **æ¯ä¸ªèˆªç­** ä¸Šé¢„è®¢äº† `seats<sub>i</sub>` ä¸ªåº§ä½ã€‚

è¯·ä½ è¿”å›ä¸€ä¸ªé•¿åº¦ä¸º `n` çš„æ•°ç»„Â  `answer` ï¼Œé‡Œé¢çš„å…ƒç´ æ˜¯æ¯ä¸ªèˆªç­é¢„å®šçš„åº§ä½æ€»æ•°ã€‚

**ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥ï¼šbookings = [[1,2,10],[2,3,20],[2,5,25]], n = 5
è¾“å‡ºï¼š[10,55,45,25,25]
è§£é‡Šï¼š
èˆªç­ç¼–å·        1   2   3   4   5
é¢„è®¢è®°å½• 1 ï¼š   10  10
é¢„è®¢è®°å½• 2 ï¼š       20  20
é¢„è®¢è®°å½• 3 ï¼š       25  25  25  25
æ€»åº§ä½æ•°ï¼š      10  55  45  25  25
å› æ­¤ï¼Œanswer = [10,55,45,25,25]
```

**ç¤ºä¾‹ 2ï¼š**

```
è¾“å…¥ï¼šbookings = [[1,2,10],[2,2,15]], n = 2
è¾“å‡ºï¼š[10,25]
è§£é‡Šï¼š
èˆªç­ç¼–å·        1   2
é¢„è®¢è®°å½• 1 ï¼š   10  10
é¢„è®¢è®°å½• 2 ï¼š       15
æ€»åº§ä½æ•°ï¼š      10  25
å› æ­¤ï¼Œanswer = [10,25]
```

**æç¤ºï¼š**

- `1 <= n <= 2 * 10<sup>4</sup>`
- `1 <= bookings.length <= 2 * 10<sup>4</sup>`
- `bookings[i].length == 3`
- `1 <= first<sub>i</sub> <= last<sub>i</sub> <= n`
- `1 <= seats<sub>i</sub> <= 10<sup>4</sup>`

é¢˜ç›®æ¥æºï¼š [åŠ›æ‰£ 1109. èˆªç­é¢„è®¢ç»Ÿè®¡](https://leetcode.cn/problems/corporate-flight-bookings/) ã€‚

å‡½æ•°ç­¾åå¦‚ä¸‹ï¼š

```
vector<int> corpFlightBookings(vector<vector<int>>& bookings, int n)
```

è¿™ä¸ªé¢˜ç›®å°±åœ¨é‚£ç»•å¼¯å¼¯ï¼Œå…¶å®å®ƒå°±æ˜¯ä¸ªå·®åˆ†æ•°ç»„çš„é¢˜ï¼Œæˆ‘ç»™ä½ ç¿»è¯‘ä¸€ä¸‹ï¼š

ç»™ä½ è¾“å…¥ä¸€ä¸ªé•¿åº¦ä¸º `n` çš„æ•°ç»„ `nums` ï¼Œå…¶ä¸­æ‰€æœ‰å…ƒç´ éƒ½æ˜¯ 0ã€‚å†ç»™ä½ è¾“å…¥ä¸€ä¸ª `bookings` ï¼Œé‡Œé¢æ˜¯è‹¥å¹²ä¸‰å…ƒç»„ `(i, j, k)` ï¼Œæ¯ä¸ªä¸‰å…ƒç»„çš„å«ä¹‰å°±æ˜¯è¦æ±‚ä½ ç»™ `nums` æ•°ç»„çš„é—­åŒºé—´ `[i-1,j-1]` ä¸­æ‰€æœ‰å…ƒç´ éƒ½åŠ ä¸Š `k` ã€‚è¯·ä½ è¿”å›æœ€åçš„ `nums` æ•°ç»„æ˜¯å¤šå°‘ï¼Ÿ

Note

å› ä¸ºé¢˜ç›®è¯´çš„ `n` æ˜¯ä» 1 å¼€å§‹è®¡æ•°çš„ï¼Œè€Œæ•°ç»„ç´¢å¼•ä» 0 å¼€å§‹ï¼Œæ‰€ä»¥å¯¹äºè¾“å…¥çš„ä¸‰å…ƒç»„ `(i, j, k)` ï¼Œæ•°ç»„åŒºé—´åº”è¯¥å¯¹åº” `[i-1,j-1]` ã€‚

è¿™ä¹ˆä¸€çœ‹ï¼Œä¸å°±æ˜¯ä¸€é“æ ‡å‡†çš„å·®åˆ†æ•°ç»„é¢˜å˜›ï¼Ÿæˆ‘ä»¬å¯ä»¥ç›´æ¥å¤ç”¨åˆšæ‰å†™çš„ç±»ï¼š

```
class Solution {

public:

    vector<int> corpFlightBookings(vector<vector<int>>& bookings, int n) {

        // nums åˆå§‹åŒ–ä¸ºå…¨ 0

        vector<int> nums(n, 0);

        // æ„é€ å·®åˆ†è§£æ³•

        Difference df(nums);

        for (const auto& booking : bookings) {

            // æ³¨æ„è½¬æˆæ•°ç»„ç´¢å¼•è¦å‡ä¸€å“¦

            int i = booking[0] - 1;

            int j = booking[1] - 1;

            int val = booking[2];

            // å¯¹åŒºé—´ nums[i..j] å¢åŠ  val

            df.increment(i, j, val);

        }

        // è¿”å›æœ€ç»ˆçš„ç»“æœæ•°ç»„

        return df.result();

    }

private:

    class Difference {

        // å·®åˆ†æ•°ç»„

        vector<int> diff;

    public:

        Difference(const vector<int>& nums) {

            assert(!nums.empty());

            diff.resize(nums.size());

            // æ„é€ å·®åˆ†æ•°ç»„

            diff[0] = nums[0];

            for (size_t i = 1; i < nums.size(); ++i) {

                diff[i] = nums[i] - nums[i - 1];

            }

        }

        // ç»™é—­åŒºé—´ [i, j] å¢åŠ  valï¼ˆå¯ä»¥æ˜¯è´Ÿæ•°ï¼‰

        void increment(int i, int j, int val) {

            diff[i] += val;

            if (j + 1 < diff.size()) {

                diff[j + 1] -= val;

            }

        }

        vector<int> result() {

            vector<int> res(diff.size());

            // æ ¹æ®å·®åˆ†æ•°ç»„æ„é€ ç»“æœæ•°ç»„

            res[0] = diff[0];

            for (size_t i = 1; i < diff.size(); ++i) {

                res[i] = res[i - 1] + diff[i];

            }

            return res;

        }

    };

};
```

è¿™é“é¢˜å°±è§£å†³äº†ã€‚

è¿˜æœ‰ä¸€é“å¾ˆç±»ä¼¼çš„é¢˜ç›®æ˜¯åŠ›æ‰£ç¬¬ 1094 é¢˜ã€Œ [æ‹¼è½¦](https://leetcode.cn/problems/car-pooling/) ã€ï¼š

**1094\. æ‹¼è½¦** | [åŠ›æ‰£](https://leetcode.cn/problems/car-pooling/) | [LeetCode](https://leetcode.com/problems/car-pooling/)

è½¦ä¸Šæœ€åˆæœ‰ `capacity` ä¸ªç©ºåº§ä½ã€‚è½¦ **åªèƒ½** å‘ä¸€ä¸ªæ–¹å‘è¡Œé©¶ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œ **ä¸å…è®¸æ‰å¤´æˆ–æ”¹å˜æ–¹å‘** ï¼‰

ç»™å®šæ•´æ•° `capacity` Â å’Œä¸€ä¸ªæ•°ç»„ `trips`, Â `trip[i] = [numPassengers<sub>i</sub>, from<sub>i</sub>, to<sub>i</sub>]` è¡¨ç¤ºç¬¬ `i` æ¬¡æ—…è¡Œæœ‰Â  `numPassengers<sub>i</sub>` Â ä¹˜å®¢ï¼Œæ¥ä»–ä»¬å’Œæ”¾ä»–ä»¬çš„ä½ç½®åˆ†åˆ«æ˜¯Â  `from<sub>i</sub>` Â å’ŒÂ  `to<sub>i</sub>` ã€‚è¿™äº›ä½ç½®æ˜¯ä»æ±½è½¦çš„åˆå§‹ä½ç½®å‘ä¸œçš„å…¬é‡Œæ•°ã€‚

å½“ä¸”ä»…å½“ä½ å¯ä»¥åœ¨æ‰€æœ‰ç»™å®šçš„è¡Œç¨‹ä¸­æ¥é€æ‰€æœ‰ä¹˜å®¢æ—¶ï¼Œè¿”å› `true` ï¼Œå¦åˆ™è¯·è¿”å› `false` ã€‚

**ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥ï¼štrips = [[2,1,5],[3,3,7]], capacity = 4
è¾“å‡ºï¼šfalse
```

**ç¤ºä¾‹ 2ï¼š**

```
è¾“å…¥ï¼štrips = [[2,1,5],[3,3,7]], capacity = 5
è¾“å‡ºï¼štrue
```

**æç¤ºï¼š**

- `1 <= trips.length <= 1000`
- `trips[i].length == 3`
- `1 <= numPassengers<sub>i</sub>Â <= 100`
- `0 <= from<sub>i</sub>Â < to<sub>i</sub>Â <= 1000`
- `1 <= capacity <= 10<sup>5</sup>`

é¢˜ç›®æ¥æºï¼š [åŠ›æ‰£ 1094. æ‹¼è½¦](https://leetcode.cn/problems/car-pooling/) ã€‚

å‡½æ•°ç­¾åå¦‚ä¸‹ï¼š

```
bool carPooling(vector<vector<int>>& trips, int capacity);
```

æ¯”å¦‚è¾“å…¥ï¼š

```
trips = [[2,1,5],[3,3,7]], capacity = 4
```

è¿™å°±ä¸èƒ½ä¸€æ¬¡è¿å®Œï¼Œå› ä¸º `trips[1]` æœ€å¤šåªèƒ½ä¸Š 2 äººï¼Œå¦åˆ™è½¦å°±ä¼šè¶…è½½ã€‚

ç›¸ä¿¡ä½ å·²ç»èƒ½å¤Ÿè”æƒ³åˆ°å·®åˆ†æ•°ç»„æŠ€å·§äº†ï¼š **`trips[i]` ä»£è¡¨ç€ä¸€ç»„åŒºé—´æ“ä½œï¼Œæ—…å®¢çš„ä¸Šè½¦å’Œä¸‹è½¦å°±ç›¸å½“äºæ•°ç»„çš„åŒºé—´åŠ å‡ï¼›åªè¦ç»“æœæ•°ç»„ä¸­çš„å…ƒç´ éƒ½å°äº `capacity` ï¼Œå°±è¯´æ˜å¯ä»¥ä¸è¶…è½½è¿è¾“æ‰€æœ‰æ—…å®¢** ã€‚

ä½†é—®é¢˜æ˜¯ï¼Œå·®åˆ†æ•°ç»„çš„é•¿åº¦ï¼ˆè½¦ç«™çš„ä¸ªæ•°ï¼‰åº”è¯¥æ˜¯å¤šå°‘å‘¢ï¼Ÿé¢˜ç›®æ²¡æœ‰ç›´æ¥ç»™ï¼Œä½†ç»™å‡ºäº†æ•°æ®å–å€¼èŒƒå›´ï¼š

```
0 <= trips[i][1] < trips[i][2] <= 1000
```

è½¦ç«™ç¼–å·ä» 0 å¼€å§‹ï¼Œæœ€å¤šåˆ° 1000ï¼Œä¹Ÿå°±æ˜¯æœ€å¤šæœ‰ 1001 ä¸ªè½¦ç«™ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„å·®åˆ†æ•°ç»„é•¿åº¦å¯ä»¥ç›´æ¥è®¾ç½®ä¸º 1001ï¼Œè¿™æ ·ç´¢å¼•åˆšå¥½èƒ½å¤Ÿæ¶µç›–æ‰€æœ‰è½¦ç«™çš„ç¼–å·ï¼š

```
class Solution {

public:

    bool carPooling(vector<vector<int>>& trips, int capacity) {

        // æœ€å¤šæœ‰ 1000 ä¸ªè½¦ç«™

        vector<int> nums(1001, 0);

        // æ„é€ å·®åˆ†è§£æ³•

        Difference df(nums);

        for (const auto& trip : trips) {

            // ä¹˜å®¢æ•°é‡

            int val = trip[0];

            // ç¬¬ trip[1] ç«™ä¹˜å®¢ä¸Šè½¦

            int i = trip[1];

            // ç¬¬ trip[2] ç«™ä¹˜å®¢å·²ç»ä¸‹è½¦ï¼Œ

            // å³ä¹˜å®¢åœ¨è½¦ä¸Šçš„åŒºé—´æ˜¯ [trip[1], trip[2] - 1]

            int j = trip[2] - 1;

            // è¿›è¡ŒåŒºé—´æ“ä½œ

            df.increment(i, j, val);

        }

        vector<int> res = df.result();

        // å®¢è½¦è‡ªå§‹è‡³ç»ˆéƒ½ä¸åº”è¯¥è¶…è½½

        for (int i = 0; i < res.size(); i++) {

            if (capacity < res[i]) {

                return false;

            }

        }

        return true;

    }

    // å·®åˆ†æ•°ç»„å·¥å…·ç±»

    class Difference {

    private:

        // å·®åˆ†æ•°ç»„

        vector<int> diff;

    public:

        // è¾“å…¥ä¸€ä¸ªåˆå§‹æ•°ç»„ï¼ŒåŒºé—´æ“ä½œå°†åœ¨è¿™ä¸ªæ•°ç»„ä¸Šè¿›è¡Œ

        Difference(vector<int>& nums) {

            assert(!nums.empty());

            diff.resize(nums.size());

            // æ ¹æ®åˆå§‹æ•°ç»„æ„é€ å·®åˆ†æ•°ç»„

            diff[0] = nums[0];

            for (int i = 1; i < nums.size(); i++) {

                diff[i] = nums[i] - nums[i - 1];

            }

        }

        // ç»™é—­åŒºé—´ [i, j] å¢åŠ  valï¼ˆå¯ä»¥æ˜¯è´Ÿæ•°ï¼‰

        void increment(int i, int j, int val) {

            diff[i] += val;

            if (j + 1 < diff.size()) {

                diff[j + 1] -= val;

            }

        }

        // è¿”å›ç»“æœæ•°ç»„

        vector<int> result() {

            vector<int> res(diff.size());

            // æ ¹æ®å·®åˆ†æ•°ç»„æ„é€ ç»“æœæ•°ç»„

            res[0] = diff[0];

            for (int i = 1; i < diff.size(); i++) {

                res[i] = res[i - 1] + diff[i];

            }

            return res;

        }

    };

};
```

è‡³æ­¤ï¼Œè¿™é“é¢˜ä¹Ÿè§£å†³äº†ã€‚

å·®åˆ†æ•°ç»„å’Œå‰ç¼€å’Œæ•°ç»„éƒ½æ˜¯æ¯”è¾ƒå¸¸è§ä¸”å·§å¦™çš„ç®—æ³•æŠ€å·§ï¼Œåˆ†åˆ«é€‚ç”¨ä¸åŒçš„åœºæ™¯ï¼Œè€Œä¸”æ˜¯ä¼šè€…ä¸éš¾ï¼Œéš¾è€…ä¸ä¼šã€‚

## æ‹“å±•å»¶ä¼¸

ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œæƒ³è¦ä½¿ç”¨å·®åˆ†æ•°ç»„æŠ€å·§ï¼Œå¿…é¡»åˆ›å»ºä¸€ä¸ªé•¿åº¦å’ŒåŒºé—´é•¿åº¦ä¸€æ ·çš„å·®åˆ†æ•°ç»„ `diff` ï¼Œé‚£å¦‚æœæˆ‘æœ‰ä¸€ä¸ªéå¸¸å¤§çš„åŒºé—´ï¼Œæ¯”å¦‚ `[0, 10^9]` ï¼Œé‚£å²‚ä¸æ˜¯ä¸Šæ¥å°±è¦åˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º `10^9` çš„æ•°ç»„ï¼Œæ‰èƒ½å¼€å§‹åŒºé—´å¢å‡æ“ä½œï¼Ÿ

ç¬¬äºŒä¸ªé—®é¢˜ï¼Œå‰ç¼€å’ŒæŠ€å·§å¯ä»¥å¿«é€Ÿè¿›è¡ŒåŒºé—´æŸ¥è¯¢ï¼Œå·®åˆ†æ•°ç»„å¯ä»¥å¿«é€Ÿè¿›è¡ŒåŒºé—´å¢å‡ã€‚èƒ½ä¸èƒ½æŠŠä»–ä¿©ç»“åˆèµ·æ¥ï¼Œæ—¢å¯ä»¥å¿«é€Ÿè¿›è¡ŒåŒºé—´å¢å‡ï¼Œåˆå¯ä»¥éšæ—¶è¿›è¡ŒåŒºé—´æŸ¥è¯¢ï¼Ÿ

å…¶å®è¿™ä¸¤ä¸ªé—®é¢˜æ˜¯å¤„ç†åŒºé—´é—®é¢˜çš„å¸¸è§é—®é¢˜ï¼Œç»ˆæç­”æ¡ˆæ˜¯ [çº¿æ®µæ ‘](https://labuladong.online/zh/algo/data-structure-basic/segment-tree-basic/) è¿™ç§æ•°æ®ç»“æ„ï¼Œå®ƒå¯ä»¥åœ¨ $O(\log N)$ çš„æ—¶é—´å¤æ‚åº¦å†…å®Œæˆä»»æ„é•¿åº¦çš„åŒºé—´å¢å‡å’ŒåŒºé—´æŸ¥è¯¢æ“ä½œã€‚

æ›´æ–°æ—¶é—´ï¼š2026/02/17 14:24

## è¯„è®º

Markdown

Ctrl+Enter å‘è¡¨